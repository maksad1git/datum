# üó∫Ô∏è –ü–õ–ê–ù –†–ê–ó–í–ò–¢–ò–Ø –°–ò–°–¢–ï–ú–´ DATUM

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-22
**–ü—Ä–æ–µ–∫—Ç:** Datum - –°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –ø–æ–ª–µ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —é–≤–µ–ª–∏—Ä–Ω–æ–≥–æ —Ä–∏—Ç–µ–π–ª–∞

---

## üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï –°–ò–°–¢–ï–ú–´

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | –¢–µ–∫—É—â–∞—è –æ—Ü–µ–Ω–∫–∞ | –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã |
|-------------|---------------|-------------------|
| **–ü–æ–ª–µ–≤—ã–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∏** (Mobile) | **5/10** | ‚ùå –ù–µ—Ç –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞<br>‚ùå –ù–µ—Ç –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è<br>‚ùå –ù–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ |
| **–ê–Ω–∞–ª–∏—Ç–∏–∫–∏** (Multi-device) | **3/10** | ‚ùå –î–∞—à–±–æ—Ä–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ JSON<br>‚ùå –ù–µ—Ç –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏<br>‚ùå –ù–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤ |
| **–ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤** (Multi-device) | **2/10** | ‚ùå –û—Ç—á–µ—Ç—ã ‚Äî —ç—Ç–æ RAW JSON<br>‚ùå –ù–µ—Ç PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏<br>‚ùå –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

- ‚úÖ **57% –º–µ—Ç—Ä–∏–∫** –º–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –°–ï–ô–ß–ê–° (12 –∏–∑ 21)
- ‚ö†Ô∏è **19% –º–µ—Ç—Ä–∏–∫** —Ç—Ä–µ–±—É—é—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ (4 –∏–∑ 21)
- ‚ùå **24% –º–µ—Ç—Ä–∏–∫** —Ç—Ä–µ–±—É—é—Ç –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π (5 –∏–∑ 21)

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. üî¥ **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤ –∏ –æ—Ç—á–µ—Ç–æ–≤** - —Å–∏—Å—Ç–µ–º–∞ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
2. üî¥ **Progressive Web App (PWA)** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞ –≤ –æ—Ñ—Ñ–ª–∞–π–Ω
3. üî¥ **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º** - —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
4. üü° **–§–∏–ª—å—Ç—Ä—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏** - –Ω–µ–ª—å–∑—è –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º/—Ä–µ–≥–∏–æ–Ω–∞–º
5. üü° **PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** - –Ω–µ–ª—å–∑—è —Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –æ—Ç—á–µ—Ç—ã
6. üü° **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è** - –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –Ω–∞ —Ç–æ—á–∫–µ
7. üü° **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ** - –Ω–µ—É–¥–æ–±–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Ñ–æ—Ç–æ—Ñ–∏–∫—Å–∞—Ü–∏–∏

---

## üéØ –ü–õ–ê–ù –†–ê–ó–í–ò–¢–ò–Ø

### **–§–ê–ó–ê 1: –ú–ò–ù–ò–ú–ê–õ–¨–ù–û –ñ–ò–ó–ù–ï–°–ü–û–°–û–ë–ù–´–ô –ü–†–û–î–£–ö–¢** (2-3 –Ω–µ–¥–µ–ª–∏)

**–¶–µ–ª—å:** –°–¥–µ–ª–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –†–ê–ë–û–¢–ê–Æ–©–ï–ô –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### 1.1. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤ —Å Chart.js üî¥ –ö–†–ò–¢–ò–ß–ù–û

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- `analytics/views.py` - –¥–æ–±–∞–≤–∏—Ç—å `DashboardDetailView.get_context_data()`
- `analytics/views.py` - –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã `calculate_metric()`, `calculate_chart()`
- `templates/analytics/dashboard_detail.html` - –∑–∞–º–µ–Ω–∏—Ç—å JSON –Ω–∞ –≤–∏–¥–∂–µ—Ç—ã
- `templates/analytics/includes/metric_widget.html` - –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- `templates/analytics/includes/chart_widget.html` - –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
# analytics/views.py
from django.db.models import Avg, Count, Sum, Min, Max
from visits.models import Visit, Observation
from coefficients.models import Coefficient

class DashboardDetailView(LoginRequiredMixin, DetailView):
    model = Dashboard
    template_name = 'analytics/dashboard_detail.html'

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)

        # –ü–∞—Ä—Å–∏—Ç—å config JSON –∏ –≤—ã—á–∏—Å–ª—è—Ç—å –º–µ—Ç—Ä–∏–∫–∏
        config = self.object.config or {}
        widgets = []

        for widget_config in config.get('widgets', []):
            if widget_config['type'] == 'metric':
                metric_data = self.calculate_metric(widget_config)
                widgets.append(metric_data)
            elif widget_config['type'] == 'chart':
                chart_data = self.calculate_chart(widget_config)
                widgets.append(chart_data)

        context['widgets'] = widgets
        return context

    def calculate_metric(self, config):
        """–í—ã—á–∏—Å–ª–∏—Ç—å —á–∏—Å–ª–æ–≤—É—é –º–µ—Ç—Ä–∏–∫—É"""
        coefficient_id = config.get('coefficient_id')
        aggregation = config.get('aggregation', 'avg')

        queryset = Observation.objects.filter(coefficient_id=coefficient_id)

        if aggregation == 'avg':
            value = queryset.aggregate(Avg('value_numeric'))['value_numeric__avg']
        elif aggregation == 'sum':
            value = queryset.aggregate(Sum('value_numeric'))['value_numeric__sum']
        elif aggregation == 'count':
            value = queryset.count()
        elif aggregation == 'min':
            value = queryset.aggregate(Min('value_numeric'))['value_numeric__min']
        elif aggregation == 'max':
            value = queryset.aggregate(Max('value_numeric'))['value_numeric__max']

        return {
            'type': 'metric',
            'title': config.get('title'),
            'value': round(value, 2) if value else 0,
            'unit': config.get('unit', ''),
            'color': config.get('color', 'primary'),
        }

    def calculate_chart(self, config):
        """–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞"""
        coefficient_id = config.get('coefficient_id')
        chart_type = config.get('chart_type', 'line')
        group_by = config.get('group_by', 'date')

        # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–∞–º
        if group_by == 'date':
            data = Observation.objects.filter(
                coefficient_id=coefficient_id
            ).extra(
                select={'date': "DATE(created_at)"}
            ).values('date').annotate(
                avg_value=Avg('value_numeric')
            ).order_by('date')

            labels = [item['date'].strftime('%d.%m.%Y') for item in data]
            values = [float(item['avg_value']) if item['avg_value'] else 0 for item in data]

        # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
        elif group_by == 'region':
            data = Observation.objects.filter(
                coefficient_id=coefficient_id
            ).select_related(
                'visit__outlet__region'
            ).values(
                'visit__outlet__region__name'
            ).annotate(
                avg_value=Avg('value_numeric')
            ).order_by('-avg_value')

            labels = [item['visit__outlet__region__name'] for item in data]
            values = [float(item['avg_value']) if item['avg_value'] else 0 for item in data]

        return {
            'type': 'chart',
            'title': config.get('title'),
            'chart_type': chart_type,
            'labels': labels,
            'values': values,
            'color': config.get('color', 'rgb(75, 192, 192)'),
        }
```

```html
<!-- templates/analytics/dashboard_detail.html -->
{% extends 'base.html' %}

{% block title %}{{ object.name }} - Datum{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="h2">
            <i class="bi bi-graph-up"></i> {{ object.name }}
        </h1>
        <p class="text-muted">{{ object.description }}</p>
    </div>
    <div class="col-auto">
        <button class="btn btn-primary" onclick="refreshDashboard()">
            <i class="bi bi-arrow-clockwise"></i> –û–±–Ω–æ–≤–∏—Ç—å
        </button>
        <a href="{% url 'analytics:dashboard_update' object.pk %}" class="btn btn-warning">
            <i class="bi bi-pencil"></i> –ù–∞—Å—Ç—Ä–æ–∏—Ç—å
        </a>
    </div>
</div>

<div class="row">
    {% for widget in widgets %}
    <div class="col-md-6 col-lg-{% if widget.type == 'metric' %}3{% else %}6{% endif %} mb-4">
        {% if widget.type == 'metric' %}
        <!-- –ú–µ—Ç—Ä–∏–∫–∞ -->
        <div class="card border-{{ widget.color }}">
            <div class="card-body text-center">
                <h6 class="text-muted text-uppercase small">{{ widget.title }}</h6>
                <h2 class="display-4 mb-0 text-{{ widget.color }}">
                    {{ widget.value }}
                    {% if widget.unit %}
                    <small class="text-muted fs-5">{{ widget.unit }}</small>
                    {% endif %}
                </h2>
            </div>
        </div>

        {% elif widget.type == 'chart' %}
        <!-- –ì—Ä–∞—Ñ–∏–∫ -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">{{ widget.title }}</h5>
            </div>
            <div class="card-body">
                <canvas id="chart_{{ forloop.counter }}" height="200"></canvas>
            </div>
        </div>
        <script>
        new Chart(document.getElementById('chart_{{ forloop.counter }}'), {
            type: '{{ widget.chart_type }}',
            data: {
                labels: {{ widget.labels|safe }},
                datasets: [{
                    label: '{{ widget.title }}',
                    data: {{ widget.values|safe }},
                    backgroundColor: '{{ widget.color }}',
                    borderColor: '{{ widget.color }}',
                    borderWidth: 2,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        </script>
        {% endif %}
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i>
            –î–∞—à–±–æ—Ä–¥ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. <a href="{% url 'analytics:dashboard_update' object.pk %}">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∏–¥–∂–µ—Ç—ã</a>
        </div>
    </div>
    {% endfor %}
</div>

<script>
function refreshDashboard() {
    location.reload();
}
</script>
{% endblock %}
```

**–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–∞—à–±–æ—Ä–¥–∞ (JSON):**

```json
{
  "widgets": [
    {
      "type": "metric",
      "title": "–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞",
      "coefficient_id": 1,
      "aggregation": "avg",
      "unit": "‚ÇΩ",
      "color": "primary"
    },
    {
      "type": "metric",
      "title": "–í—Å–µ–≥–æ –≤–∏–∑–∏—Ç–æ–≤",
      "coefficient_id": null,
      "aggregation": "count",
      "color": "success"
    },
    {
      "type": "chart",
      "title": "–î–∏–Ω–∞–º–∏–∫–∞ —Ü–µ–Ω",
      "coefficient_id": 1,
      "chart_type": "line",
      "group_by": "date",
      "color": "rgb(75, 192, 192)"
    },
    {
      "type": "chart",
      "title": "–¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º",
      "coefficient_id": 1,
      "chart_type": "bar",
      "group_by": "region",
      "color": "rgb(255, 99, 132)"
    }
  ]
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –î–∞—à–±–æ—Ä–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∂–∏–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏

---

#### 1.2. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ üî¥ –ö–†–ò–¢–ò–ß–ù–û

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- `analytics/views.py` - –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `ReportDetailView`
- `templates/analytics/report_detail.html` - –∑–∞–º–µ–Ω–∏—Ç—å JSON –Ω–∞ —Ç–∞–±–ª–∏—Ü—ã/–≥—Ä–∞—Ñ–∏–∫–∏

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
# analytics/views.py
class ReportDetailView(LoginRequiredMixin, DetailView):
    model = Report
    template_name = 'analytics/report_detail.html'

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)

        # –ü–∞—Ä—Å–∏—Ç—å result JSON –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        result = self.object.result or {}

        # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        tables = []
        charts = []

        for section_key, section_data in result.items():
            if isinstance(section_data, list):
                # –≠—Ç–æ —Ç–∞–±–ª–∏—Ü–∞
                tables.append({
                    'title': section_key.replace('_', ' ').title(),
                    'data': section_data
                })
            elif isinstance(section_data, dict) and 'labels' in section_data:
                # –≠—Ç–æ –≥—Ä–∞—Ñ–∏–∫
                charts.append({
                    'title': section_key.replace('_', ' ').title(),
                    'type': section_data.get('type', 'bar'),
                    'labels': section_data.get('labels', []),
                    'values': section_data.get('values', [])
                })

        context['tables'] = tables
        context['charts'] = charts
        return context
```

```html
<!-- templates/analytics/report_detail.html -->
{% extends 'base.html' %}

{% block title %}{{ object.name }} - Datum{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="h2">
            <i class="bi bi-file-earmark-bar-graph"></i> {{ object.name }}
        </h1>
        <p class="text-muted">{{ object.description }}</p>
    </div>
    <div class="col-auto">
        <a href="{% url 'analytics:report_pdf' object.pk %}" class="btn btn-danger">
            <i class="bi bi-file-pdf"></i> –°–∫–∞—á–∞—Ç—å PDF
        </a>
        <button class="btn btn-primary" onclick="window.print()">
            <i class="bi bi-printer"></i> –ü–µ—á–∞—Ç—å
        </button>
    </div>
</div>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ç—á–µ—Ç–µ -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <dl class="row mb-0">
                    <dt class="col-sm-4">–°—Ç–∞—Ç—É—Å:</dt>
                    <dd class="col-sm-8">
                        {% if object.status == 'completed' %}
                            <span class="badge bg-success">–ì–æ—Ç–æ–≤</span>
                        {% elif object.status == 'processing' %}
                            <span class="badge bg-warning">–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è</span>
                        {% else %}
                            <span class="badge bg-danger">–û—à–∏–±–∫–∞</span>
                        {% endif %}
                    </dd>

                    <dt class="col-sm-4">–°–æ–∑–¥–∞–Ω:</dt>
                    <dd class="col-sm-8">{{ object.created_at|date:"d.m.Y H:i" }}</dd>

                    {% if object.template %}
                    <dt class="col-sm-4">–®–∞–±–ª–æ–Ω:</dt>
                    <dd class="col-sm-8">{{ object.template.name }}</dd>
                    {% endif %}
                </dl>
            </div>
        </div>
    </div>
</div>

<!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
{% if charts %}
<div class="row mb-4">
    {% for chart in charts %}
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">{{ chart.title }}</h5>
            </div>
            <div class="card-body">
                <canvas id="chart_{{ forloop.counter }}" height="250"></canvas>
            </div>
        </div>
    </div>
    <script>
    new Chart(document.getElementById('chart_{{ forloop.counter }}'), {
        type: '{{ chart.type }}',
        data: {
            labels: {{ chart.labels|safe }},
            datasets: [{
                label: '{{ chart.title }}',
                data: {{ chart.values|safe }},
                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true
        }
    });
    </script>
    {% endfor %}
</div>
{% endif %}

<!-- –¢–∞–±–ª–∏—Ü—ã -->
{% if tables %}
{% for table in tables %}
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">{{ table.title }}</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        {% for key in table.data.0.keys %}
                        <th>{{ key|title }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in table.data %}
                    <tr>
                        {% for value in row.values %}
                        <td>{{ value }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endfor %}
{% endif %}

<!-- –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏) -->
<details class="mt-4">
    <summary class="btn btn-sm btn-outline-secondary">–ü–æ–∫–∞–∑–∞—Ç—å —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (JSON)</summary>
    <pre class="bg-light p-3 rounded mt-2"><code>{{ object.result|safe }}</code></pre>
</details>
{% endblock %}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –û—Ç—á–µ—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–∞–±–ª–∏—Ü—ã –∏ –≥—Ä–∞—Ñ–∏–∫–∏ –≤–º–µ—Å—Ç–æ JSON

---

#### 1.3. Progressive Web App (PWA) üî¥ –ö–†–ò–¢–ò–ß–ù–û

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- `static/manifest.json` - –º–∞–Ω–∏—Ñ–µ—Å—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `static/service-worker.js` - Service Worker –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω
- `static/icons/icon-192.png` - –∏–∫–æ–Ω–∫–∞ 192x192
- `static/icons/icon-512.png` - –∏–∫–æ–Ω–∫–∞ 512x512
- –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `templates/base.html` - –ø–æ–¥–∫–ª—é—á–∏—Ç—å PWA

**1. –°–æ–∑–¥–∞—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç:**

```json
{
  "name": "Datum - –°–±–æ—Ä –ø–æ–ª–µ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö",
  "short_name": "Datum",
  "description": "–°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —é–≤–µ–ª–∏—Ä–Ω–æ–≥–æ —Ä–∏—Ç–µ–π–ª–∞",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#0d6efd",
  "orientation": "portrait",
  "icons": [
    {
      "src": "/static/icons/icon-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/static/icons/icon-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ]
}
```

**2. –°–æ–∑–¥–∞—Ç—å Service Worker:**

```javascript
// static/service-worker.js
const CACHE_NAME = 'datum-v1.0.0';
const OFFLINE_URL = '/offline/';

const CACHE_URLS = [
    '/',
    '/offline/',
    '/static/css/bootstrap.min.css',
    '/static/js/bootstrap.bundle.min.js',
    'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css',
    'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css',
];

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Service Worker
self.addEventListener('install', (event) => {
    console.log('[SW] Installing...');
    event.waitUntil(
        caches.open(CACHE_NAME).then((cache) => {
            console.log('[SW] Caching app shell');
            return cache.addAll(CACHE_URLS);
        })
    );
    self.skipWaiting();
});

// –ê–∫—Ç–∏–≤–∞—Ü–∏—è Service Worker
self.addEventListener('activate', (event) => {
    console.log('[SW] Activating...');
    event.waitUntil(
        caches.keys().then((cacheNames) => {
            return Promise.all(
                cacheNames.map((cacheName) => {
                    if (cacheName !== CACHE_NAME) {
                        console.log('[SW] Deleting old cache:', cacheName);
                        return caches.delete(cacheName);
                    }
                })
            );
        })
    );
    self.clients.claim();
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
self.addEventListener('fetch', (event) => {
    // –¢–æ–ª—å–∫–æ GET –∑–∞–ø—Ä–æ—Å—ã
    if (event.request.method !== 'GET') {
        return;
    }

    event.respondWith(
        caches.match(event.request).then((cachedResponse) => {
            if (cachedResponse) {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∑ –∫—ç—à–∞
                return cachedResponse;
            }

            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ —Å–µ—Ç–∏
            return fetch(event.request).then((response) => {
                // –ù–µ –∫—ç—à–∏—Ä—É–µ–º –Ω–µ-200 –æ—Ç–≤–µ—Ç—ã
                if (!response || response.status !== 200) {
                    return response;
                }

                // –ö—ç—à–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
                const responseToCache = response.clone();
                caches.open(CACHE_NAME).then((cache) => {
                    cache.put(event.request, responseToCache);
                });

                return response;
            }).catch(() => {
                // –ï—Å–ª–∏ —Å–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ñ—Ñ–ª–∞–π–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—É
                return caches.match(OFFLINE_URL);
            });
        })
    );
});

// Background Sync –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–æ–≥–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è —Å–µ—Ç—å
self.addEventListener('sync', (event) => {
    if (event.tag === 'sync-visits') {
        event.waitUntil(syncVisits());
    }
});

async function syncVisits() {
    const db = await openIndexedDB();
    const pendingVisits = await db.getAll('pendingVisits');

    for (const visit of pendingVisits) {
        try {
            const response = await fetch('/visits/api/sync/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(visit)
            });

            if (response.ok) {
                await db.delete('pendingVisits', visit.id);
                console.log('[SW] Synced visit:', visit.id);
            }
        } catch (error) {
            console.error('[SW] Sync failed:', error);
        }
    }
}
```

**3. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å base.html:**

```html
<!-- templates/base.html -->
<head>
    <!-- ... existing head content ... -->

    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">

    <!-- Theme color –¥–ª—è mobile browsers -->
    <meta name="theme-color" content="#0d6efd">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="/static/icons/icon-192.png">

    <!-- iOS meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Datum">
</head>

<body>
    <!-- ... existing body content ... -->

    <!-- PWA Install Banner -->
    <div id="installBanner" class="alert alert-info alert-dismissible position-fixed bottom-0 start-0 end-0 m-3" style="display: none; z-index: 9999;">
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        <div class="d-flex align-items-center">
            <i class="bi bi-download fs-3 me-3"></i>
            <div>
                <strong>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Datum</strong>
                <p class="mb-2 small">–†–∞–±–æ—Ç–∞–π—Ç–µ –æ—Ñ—Ñ–ª–∞–π–Ω –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø</p>
                <button id="installBtn" class="btn btn-primary btn-sm">
                    <i class="bi bi-plus-circle"></i> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/service-worker.js')
                    .then((registration) => {
                        console.log('‚úÖ Service Worker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.error('‚ùå Service Worker registration failed:', error);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–Ω–Ω–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∫–∏
            document.getElementById('installBanner').style.display = 'block';
        });

        document.getElementById('installBtn')?.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;

                if (outcome === 'accepted') {
                    console.log('‚úÖ PWA installed');
                }

                deferredPrompt = null;
                document.getElementById('installBanner').style.display = 'none';
            }
        });

        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA was installed');
            document.getElementById('installBanner').style.display = 'none';
        });
    </script>
</body>
```

**4. –°–æ–∑–¥–∞—Ç—å –æ—Ñ—Ñ–ª–∞–π–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—É:**

```html
<!-- templates/offline.html -->
{% extends 'base.html' %}

{% block title %}–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è - Datum{% endblock %}

{% block content %}
<div class="container text-center py-5">
    <i class="bi bi-wifi-off" style="font-size: 5rem; color: #6c757d;"></i>
    <h1 class="mt-4">–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É</h1>
    <p class="text-muted">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞</p>

    <button onclick="location.reload()" class="btn btn-primary mt-3">
        <i class="bi bi-arrow-clockwise"></i> –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
    </button>

    <div class="mt-5">
        <h5>–í—ã –º–æ–∂–µ—Ç–µ:</h5>
        <ul class="list-unstyled">
            <li>‚úÖ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</li>
            <li>‚úÖ –ó–∞–ø–æ–ª–Ω—è—Ç—å –≤–∏–∑–∏—Ç—ã –æ—Ñ—Ñ–ª–∞–π–Ω (–±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏)</li>
            <li>‚ùå –ó–∞–≥—Ä—É–∂–∞—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</li>
        </ul>
    </div>
</div>
{% endblock %}
```

**5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å URL –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**

```python
# datum/urls.py
from django.views.generic import TemplateView

urlpatterns = [
    # ... existing patterns ...
    path('offline/', TemplateView.as_view(template_name='offline.html'), name='offline'),
]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ—Ñ–ª–∞–π–Ω, –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ –¥–æ–º–∞—à–Ω–∏–π —ç–∫—Ä–∞–Ω

---

#### 1.4. –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º üî¥ –ö–†–ò–¢–ò–ß–ù–û

**–§–∞–π–ª—ã –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- `templates/visits/fill_visit.html` - –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- `static/js/autosave.js` - –Ω–æ–≤—ã–π —Ñ–∞–π–ª —Å –ª–æ–≥–∏–∫–æ–π –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:**

```javascript
// static/js/autosave.js
class FormAutosave {
    constructor(formSelector, options = {}) {
        this.form = document.querySelector(formSelector);
        if (!this.form) {
            console.error('Form not found:', formSelector);
            return;
        }

        this.storageKey = options.storageKey || `autosave_${this.form.id || 'form'}`;
        this.interval = options.interval || 30000; // 30 —Å–µ–∫—É–Ω–¥
        this.excludeFields = options.excludeFields || ['csrfmiddlewaretoken'];
        this.intervalId = null;

        this.init();
    }

    init() {
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        this.restore();

        // –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        this.startAutosave();

        // –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ
        this.form.addEventListener('submit', () => {
            this.clear();
        });

        console.log(`‚úÖ Autosave initialized for ${this.storageKey}`);
    }

    startAutosave() {
        this.intervalId = setInterval(() => {
            this.save();
        }, this.interval);
    }

    save() {
        const formData = new FormData(this.form);
        const data = {};

        for (let [key, value] of formData.entries()) {
            if (!this.excludeFields.includes(key)) {
                data[key] = value;
            }
        }

        const autosaveData = {
            data: data,
            timestamp: Date.now(),
            url: window.location.pathname
        };

        try {
            localStorage.setItem(this.storageKey, JSON.stringify(autosaveData));
            this.showNotification('üíæ –§–æ—Ä–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞', 'success');
            console.log('‚úÖ Form autosaved');
        } catch (error) {
            console.error('‚ùå Autosave failed:', error);
        }
    }

    restore() {
        try {
            const saved = localStorage.getItem(this.storageKey);
            if (!saved) return;

            const { data, timestamp, url } = JSON.parse(saved);

            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —ç—Ç–æ —Ç–∞ –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            if (url !== window.location.pathname) {
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ–∑—Ä–∞—Å—Ç –¥–∞–Ω–Ω—ã—Ö (–Ω–µ –±–æ–ª—å—à–µ 24 —á–∞—Å–æ–≤)
            const ageHours = (Date.now() - timestamp) / (1000 * 60 * 60);
            if (ageHours > 24) {
                this.clear();
                return;
            }

            const ageMinutes = Math.round((Date.now() - timestamp) / (1000 * 60));

            // –°–ø—Ä–æ—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (confirm(`–ù–∞–π–¥–µ–Ω–æ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã (${ageMinutes} –º–∏–Ω –Ω–∞–∑–∞–¥).\n\n–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ?`)) {
                this.fillForm(data);
                this.showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'info');
            } else {
                this.clear();
            }
        } catch (error) {
            console.error('‚ùå Restore failed:', error);
        }
    }

    fillForm(data) {
        Object.keys(data).forEach(key => {
            const input = this.form.querySelector(`[name="${key}"]`);
            if (!input) return;

            if (input.type === 'checkbox') {
                input.checked = data[key] === 'on' || data[key] === true;
            } else if (input.type === 'radio') {
                const radio = this.form.querySelector(`[name="${key}"][value="${data[key]}"]`);
                if (radio) radio.checked = true;
            } else {
                input.value = data[key];
            }
        });
    }

    clear() {
        localStorage.removeItem(this.storageKey);
        console.log('üóëÔ∏è Autosave cleared');
    }

    showNotification(message, type = 'info') {
        // –°–æ–∑–¥–∞—Ç—å toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const toast = document.createElement('div');
        toast.className = `alert alert-${type} alert-dismissible position-fixed top-0 end-0 m-3`;
        toast.style.zIndex = '9999';
        toast.innerHTML = `
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            <small>${message}</small>
        `;
        document.body.appendChild(toast);

        setTimeout(() => {
            toast.remove();
        }, 3000);
    }

    destroy() {
        if (this.intervalId) {
            clearInterval(this.intervalId);
        }
    }
}

// –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
window.FormAutosave = FormAutosave;
```

**–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å fill_visit.html:**

```html
<!-- templates/visits/fill_visit.html -->
{% extends 'base.html' %}

{% block extra_js %}
<script src="/static/js/autosave.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    const autosave = new FormAutosave('form', {
        storageKey: 'visit_{{ visit.id }}_autosave',
        interval: 30000, // 30 —Å–µ–∫—É–Ω–¥
        excludeFields: ['csrfmiddlewaretoken']
    });

    // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    const autosaveIndicator = document.createElement('div');
    autosaveIndicator.className = 'text-muted small mt-2';
    autosaveIndicator.innerHTML = '<i class="bi bi-cloud-check"></i> –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)';
    document.querySelector('form').insertBefore(
        autosaveIndicator,
        document.querySelector('form').firstChild
    );
});
</script>
{% endblock %}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –§–æ—Ä–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫, –¥–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ

---

### **–§–ê–ó–ê 2: –ü–û–õ–ù–û–§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê** (1-2 –Ω–µ–¥–µ–ª–∏)

**–¶–µ–ª—å:** –°–¥–µ–ª–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –£–î–û–ë–ù–û–ô –∏ –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–ô

#### 2.1. –§–∏–ª—å—Ç—Ä—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ üü°

**–°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤:**

```html
<!-- templates/analytics/includes/filters.html -->
<div class="card mb-4">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="bi bi-funnel"></i> –§–∏–ª—å—Ç—Ä—ã</h5>
            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="resetFilters()">
                <i class="bi bi-arrow-clockwise"></i> –°–±—Ä–æ—Å–∏—Ç—å
            </button>
        </div>
    </div>
    <div class="card-body">
        <form method="get" id="filterForm">
            <div class="row g-3">
                <!-- –ü–µ—Ä–∏–æ–¥ -->
                <div class="col-md-3">
                    <label class="form-label">–ü–µ—Ä–∏–æ–¥</label>
                    <select name="period" class="form-select" onchange="toggleCustomDates()">
                        <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
                        <option value="yesterday">–í—á–µ—Ä–∞</option>
                        <option value="week">–≠—Ç–∞ –Ω–µ–¥–µ–ª—è</option>
                        <option value="last_week">–ü—Ä–æ—à–ª–∞—è –Ω–µ–¥–µ–ª—è</option>
                        <option value="month">–≠—Ç–æ—Ç –º–µ—Å—è—Ü</option>
                        <option value="last_month">–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü</option>
                        <option value="quarter">–ö–≤–∞—Ä—Ç–∞–ª</option>
                        <option value="year">–ì–æ–¥</option>
                        <option value="custom">–°–≤–æ–π –ø–µ—Ä–∏–æ–¥</option>
                    </select>
                </div>

                <!-- –î–∞—Ç—ã (–¥–ª—è custom) -->
                <div class="col-md-3" id="customDates" style="display: none;">
                    <label class="form-label">–û—Ç - –î–æ</label>
                    <div class="input-group">
                        <input type="date" name="date_from" class="form-control">
                        <input type="date" name="date_to" class="form-control">
                    </div>
                </div>

                <!-- –†–µ–≥–∏–æ–Ω -->
                <div class="col-md-2">
                    <label class="form-label">–†–µ–≥–∏–æ–Ω</label>
                    <select name="region" class="form-select">
                        <option value="">–í—Å–µ</option>
                        {% for region in regions %}
                        <option value="{{ region.id }}">{{ region.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- –ö–∞–Ω–∞–ª -->
                <div class="col-md-2">
                    <label class="form-label">–ö–∞–Ω–∞–ª</label>
                    <select name="channel" class="form-select">
                        <option value="">–í—Å–µ</option>
                        {% for channel in channels %}
                        <option value="{{ channel.id }}">{{ channel.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞ -->
                <div class="col-md-2">
                    <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select name="category" class="form-select">
                        <option value="">–í—Å–µ</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ -->
                <div class="col-md-12">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="saveFilterPreset()">
                        <i class="bi bi-bookmark"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
function toggleCustomDates() {
    const period = document.querySelector('[name="period"]').value;
    const customDates = document.getElementById('customDates');
    customDates.style.display = period === 'custom' ? 'block' : 'none';
}

function resetFilters() {
    window.location.href = window.location.pathname;
}

function saveFilterPreset() {
    const name = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞:');
    if (!name) return;

    const formData = new FormData(document.getElementById('filterForm'));
    const filters = Object.fromEntries(formData.entries());

    fetch('/analytics/filter-presets/create/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({
            name: name,
            filters: filters
        })
    }).then(response => {
        if (response.ok) {
            alert('‚úÖ –§–∏–ª—å—Ç—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
        }
    });
}
</script>
```

**–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å views –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤:**

```python
# analytics/views.py
from datetime import datetime, timedelta
from django.utils import timezone

class DashboardDetailView(LoginRequiredMixin, DetailView):
    model = Dashboard

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)

        # –ü–æ–ª—É—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–∑ GET –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        filters = self.get_filters()

        # –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∫ –¥–∞–Ω–Ω—ã–º
        # ... (–ø–µ—Ä–µ–¥–∞—Ç—å filters –≤ calculate_metric –∏ calculate_chart)

        context['filters'] = filters
        context['regions'] = Region.objects.all()
        context['channels'] = Channel.objects.all()
        context['categories'] = Category.objects.all()
        return context

    def get_filters(self):
        period = self.request.GET.get('period', 'month')

        # –í—ã—á–∏—Å–ª–∏—Ç—å –¥–∞—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–∏–æ–¥–∞
        now = timezone.now()

        if period == 'today':
            date_from = now.replace(hour=0, minute=0, second=0)
            date_to = now
        elif period == 'yesterday':
            date_from = (now - timedelta(days=1)).replace(hour=0, minute=0, second=0)
            date_to = now.replace(hour=0, minute=0, second=0)
        elif period == 'week':
            date_from = now - timedelta(days=now.weekday())
            date_to = now
        elif period == 'month':
            date_from = now.replace(day=1, hour=0, minute=0, second=0)
            date_to = now
        elif period == 'custom':
            date_from = self.request.GET.get('date_from')
            date_to = self.request.GET.get('date_to')

        return {
            'period': period,
            'date_from': date_from,
            'date_to': date_to,
            'region': self.request.GET.get('region'),
            'channel': self.request.GET.get('channel'),
            'category': self.request.GET.get('category'),
        }
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ú–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º, —Ä–µ–≥–∏–æ–Ω–∞–º, –∫–∞–Ω–∞–ª–∞–º

---

#### 2.2. PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ üü°

**–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É:**

```bash
pip install weasyprint
```

**–°–æ–∑–¥–∞—Ç—å view –¥–ª—è PDF:**

```python
# analytics/views.py
from django.http import HttpResponse
from weasyprint import HTML
from django.template.loader import render_to_string

class ReportPDFView(LoginRequiredMixin, DetailView):
    model = Report

    def get(self, request, *args, **kwargs):
        report = self.get_object()

        # –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
        context = {
            'report': report,
            'results': report.result or {},
            'generated_at': timezone.now(),
        }

        # –†–µ–Ω–¥–µ—Ä–∏—Ç—å HTML —à–∞–±–ª–æ–Ω
        html_string = render_to_string('analytics/report_pdf.html', context)

        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ PDF
        html = HTML(string=html_string, base_url=request.build_absolute_uri())
        pdf = html.write_pdf()

        # –í–µ—Ä–Ω—É—Ç—å PDF
        response = HttpResponse(pdf, content_type='application/pdf')
        response['Content-Disposition'] = f'attachment; filename="report_{report.code}_{timezone.now().strftime("%Y%m%d")}.pdf"'
        return response
```

**–°–æ–∑–¥–∞—Ç—å PDF —à–∞–±–ª–æ–Ω:**

```html
<!-- templates/analytics/report_pdf.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{{ report.name }}</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }
        body {
            font-family: Arial, sans-serif;
            font-size: 12pt;
        }
        h1 {
            color: #0d6efd;
            border-bottom: 2px solid #0d6efd;
            padding-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .header {
            text-align: right;
            color: #6c757d;
            font-size: 10pt;
            margin-bottom: 20px;
        }
        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            text-align: center;
            font-size: 9pt;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="header">
        –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: {{ generated_at|date:"d.m.Y H:i" }}
    </div>

    <h1>{{ report.name }}</h1>

    {% if report.description %}
    <p>{{ report.description }}</p>
    {% endif %}

    <div>
        <strong>–°—Ç–∞—Ç—É—Å:</strong> {{ report.get_status_display }}<br>
        {% if report.template %}
        <strong>–®–∞–±–ª–æ–Ω:</strong> {{ report.template.name }}<br>
        {% endif %}
    </div>

    <hr>

    <!-- –¢–∞–±–ª–∏—Ü—ã —Å –¥–∞–Ω–Ω—ã–º–∏ -->
    {% for section_key, section_data in results.items %}
    <h2>{{ section_key|title }}</h2>

    {% if section_data is list %}
    <table>
        <thead>
            <tr>
                {% for key in section_data.0.keys %}
                <th>{{ key|title }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in section_data %}
            <tr>
                {% for value in row.values %}
                <td>{{ value }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>{{ section_data }}</p>
    {% endif %}
    {% endfor %}

    <div class="footer">
        –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å–∏—Å—Ç–µ–º–æ–π Datum &copy; 2025
    </div>
</body>
</html>
```

**–î–æ–±–∞–≤–∏—Ç—å URL:**

```python
# analytics/urls.py
path('reports/<int:pk>/pdf/', views.ReportPDFView.as_view(), name='report_pdf'),
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ú–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç—ã –≤ PDF

---

#### 2.3. –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –¥–ª—è –≤–∏–∑–∏—Ç–æ–≤ üü°

**–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å Visit:**

```python
# visits/models.py
class Visit(models.Model):
    # ... existing fields ...

    # –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
    latitude = models.DecimalField(
        max_digits=9,
        decimal_places=6,
        null=True,
        blank=True,
        verbose_name="–®–∏—Ä–æ—Ç–∞"
    )
    longitude = models.DecimalField(
        max_digits=9,
        decimal_places=6,
        null=True,
        blank=True,
        verbose_name="–î–æ–ª–≥–æ—Ç–∞"
    )
    location_verified = models.BooleanField(
        default=False,
        verbose_name="–õ–æ–∫–∞—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞"
    )
    distance_from_outlet = models.IntegerField(
        null=True,
        blank=True,
        verbose_name="–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ç–æ—á–∫–∏ (–º)"
    )
```

**–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:**

```bash
python manage.py makemigrations
python manage.py migrate
```

**–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ Outlet (–µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç):**

```python
# geo/models.py
class Outlet(models.Model):
    # ... existing fields ...

    latitude = models.DecimalField(
        max_digits=9,
        decimal_places=6,
        null=True,
        blank=True
    )
    longitude = models.DecimalField(
        max_digits=9,
        decimal_places=6,
        null=True,
        blank=True
    )
```

**–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å fill_visit.html:**

```html
<!-- templates/visits/fill_visit.html -->
{% block extra_js %}
<script>
// –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
let userLocation = null;

function getLocation() {
    if ("geolocation" in navigator) {
        const locationBtn = document.getElementById('locationBtn');
        locationBtn.innerHTML = '<i class="bi bi-geo-alt"></i> –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...';
        locationBtn.disabled = true;

        navigator.geolocation.getCurrentPosition(
            function(position) {
                userLocation = {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude,
                    accuracy: position.coords.accuracy
                };

                // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è
                document.getElementById('latitude').value = userLocation.latitude;
                document.getElementById('longitude').value = userLocation.longitude;

                // –í—ã—á–∏—Å–ª–∏—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ç–æ—á–∫–∏
                const outletLat = {{ visit.outlet.latitude|default:0 }};
                const outletLon = {{ visit.outlet.longitude|default:0 }};

                if (outletLat && outletLon) {
                    const distance = calculateDistance(
                        userLocation.latitude,
                        userLocation.longitude,
                        outletLat,
                        outletLon
                    );

                    document.getElementById('distance').value = Math.round(distance);

                    // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
                    let statusHtml = '';
                    if (distance <= 50) {
                        statusHtml = `<div class="alert alert-success">
                            <i class="bi bi-check-circle-fill"></i>
                            –í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –Ω–∞ —Ç–æ—á–∫–µ (${Math.round(distance)}–º)
                        </div>`;
                    } else if (distance <= 200) {
                        statusHtml = `<div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle-fill"></i>
                            –í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ ${Math.round(distance)}–º –æ—Ç —Ç–æ—á–∫–∏
                        </div>`;
                    } else {
                        statusHtml = `<div class="alert alert-danger">
                            <i class="bi bi-x-circle-fill"></i>
                            –í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –¥–∞–ª–µ–∫–æ –æ—Ç —Ç–æ—á–∫–∏ (${Math.round(distance)}–º)
                        </div>`;
                    }

                    document.getElementById('locationStatus').innerHTML = statusHtml;
                }

                locationBtn.innerHTML = '<i class="bi bi-geo-alt-fill"></i> –õ–æ–∫–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞';
                locationBtn.classList.remove('btn-primary');
                locationBtn.classList.add('btn-success');
            },
            function(error) {
                console.error('Geolocation error:', error);
                locationBtn.innerHTML = '<i class="bi bi-geo-alt"></i> –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è';
                locationBtn.classList.add('btn-danger');

                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏.');
            },
            {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            }
        );
    } else {
        alert('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º');
    }
}

// –§–æ—Ä–º—É–ª–∞ Haversine –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371e3; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –º–µ—Ç—Ä–∞—Ö
    const œÜ1 = lat1 * Math.PI / 180;
    const œÜ2 = lat2 * Math.PI / 180;
    const ŒîœÜ = (lat2 - lat1) * Math.PI / 180;
    const ŒîŒª = (lon2 - lon1) * Math.PI / 180;

    const a = Math.sin(ŒîœÜ/2) * Math.sin(ŒîœÜ/2) +
              Math.cos(œÜ1) * Math.cos(œÜ2) *
              Math.sin(ŒîŒª/2) * Math.sin(ŒîŒª/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

    return R * c; // —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –º–µ—Ç—Ä–∞—Ö
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ù–∞—á–∞—Ç—å –≤–∏–∑–∏—Ç"
document.querySelector('[name="start_visit"]')?.addEventListener('click', function(e) {
    if (!userLocation) {
        e.preventDefault();
        getLocation();

        // –ü–æ–¥–æ–∂–¥–∞—Ç—å 2 —Å–µ–∫—É–Ω–¥—ã –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É
        setTimeout(() => {
            this.form.submit();
        }, 2000);
    }
});
</script>

<!-- –î–æ–±–∞–≤–∏—Ç—å –≤ —Ñ–æ—Ä–º—É —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –∏ –∫–Ω–æ–ø–∫—É -->
<input type="hidden" name="latitude" id="latitude">
<input type="hidden" name="longitude" id="longitude">
<input type="hidden" name="distance" id="distance">

<div class="card mb-3">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-geo-alt"></i> –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</h5>
    </div>
    <div class="card-body">
        <button type="button" id="locationBtn" class="btn btn-primary" onclick="getLocation()">
            <i class="bi bi-geo-alt"></i> –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
        </button>
        <div id="locationStatus" class="mt-3"></div>
        <small class="text-muted d-block mt-2">
            <i class="bi bi-info-circle"></i>
            –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –Ω–∞ —Ç–æ—á–∫–µ
        </small>
    </div>
</div>
{% endblock %}
```

**–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å view –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:**

```python
# visits/views.py
class FillVisitView(LoginRequiredMixin, UpdateView):
    model = Visit
    # ... existing code ...

    def form_valid(self, form):
        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
        if self.request.POST.get('latitude'):
            form.instance.latitude = self.request.POST.get('latitude')
            form.instance.longitude = self.request.POST.get('longitude')
            form.instance.distance_from_outlet = self.request.POST.get('distance')

            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é (–µ—Å–ª–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 100–º - –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å)
            distance = int(self.request.POST.get('distance', 999999))
            form.instance.location_verified = distance <= 100

        return super().form_valid(form)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í–∏–∑–∏—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–∞ —Ç–æ—á–∫–µ

---

#### 2.4. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ üü°

**–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å fill_visit.html –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ multiple:**

```html
<!-- templates/visits/fill_visit.html -->
{% elif field.field_type == 'image' %}
    <input
        type="file"
        name="{{ field.field_name }}"
        class="form-control form-control-lg"
        accept="image/*"
        capture="environment"
        multiple
        id="photos_{{ field.field_name }}"
        onchange="previewPhotos(this, 'preview_{{ field.field_name }}')"
        {% if field.required %}required{% endif %}>

    <small class="form-text text-muted">
        <i class="bi bi-camera"></i> –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ
    </small>

    <!-- –ü—Ä–µ–≤—å—é —Ñ–æ—Ç–æ -->
    <div id="preview_{{ field.field_name }}" class="row mt-3"></div>
{% endif %}

<script>
function previewPhotos(input, previewId) {
    const preview = document.getElementById(previewId);
    preview.innerHTML = '';

    if (!input.files || input.files.length === 0) {
        return;
    }

    Array.from(input.files).forEach((file, index) => {
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 5MB)
        if (file.size > 5 * 1024 * 1024) {
            alert(`–§–∞–π–ª ${file.name} —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º 5MB`);
            return;
        }

        // –°–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
        compressImage(file, (compressedBlob) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const col = document.createElement('div');
                col.className = 'col-6 col-md-4 col-lg-3 mb-3';
                col.innerHTML = `
                    <div class="card">
                        <img src="${e.target.result}" class="card-img-top" style="height: 150px; object-fit: cover;">
                        <div class="card-body p-2">
                            <small class="text-muted d-block text-truncate">${file.name}</small>
                            <small class="text-success">${formatFileSize(compressedBlob.size)}</small>
                            <button type="button" class="btn btn-sm btn-danger w-100 mt-1" onclick="removePhoto(this, ${index})">
                                <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                `;
                preview.appendChild(col);
            };
            reader.readAsDataURL(compressedBlob);
        });
    });
}

function compressImage(file, callback) {
    const reader = new FileReader();
    reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
            const canvas = document.createElement('canvas');
            let width = img.width;
            let height = img.height;

            // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä 1920px
            const maxSize = 1920;
            if (width > height && width > maxSize) {
                height = (height * maxSize) / width;
                width = maxSize;
            } else if (height > maxSize) {
                width = (width * maxSize) / height;
                height = maxSize;
            }

            canvas.width = width;
            canvas.height = height;

            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);

            canvas.toBlob(callback, 'image/jpeg', 0.8);
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}

function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
}

function removePhoto(btn, index) {
    btn.closest('.col-6').remove();
    // TODO: –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –∏–∑ input.files (—Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è FileList)
}
</script>
```

**–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```python
# visits/views.py
from django.core.files.storage import default_storage

def handle_uploaded_photos(request, visit):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ"""
    photos = request.FILES.getlist('photos')

    for photo in photos:
        # –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å VisitMedia
        VisitMedia.objects.create(
            visit=visit,
            media_type='photo',
            file=photo,
            caption=photo.name
        )
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ –∑–∞ —Ä–∞–∑, —Å –ø—Ä–µ–≤—å—é –∏ —Å–∂–∞—Ç–∏–µ–º

---

### **–§–ê–ó–ê 3: –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ò –î–û–ü–û–õ–ù–ï–ù–ò–Ø** (1 –Ω–µ–¥–µ–ª—è)

**–¶–µ–ª—å:** –°–¥–µ–ª–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –û–¢–õ–ò–ß–ù–û–ô

#### 3.1. –ú–æ–¥–µ–ª–∏ –¥–ª—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –º–µ—Ç—Ä–∏–∫ üü¢

**–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏:**

```python
# geo/models.py

class FootfallCounter(models.Model):
    """–°—á—ë—Ç—á–∏–∫ –ø—Ä–æ—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏"""
    outlet = models.ForeignKey('Outlet', on_delete=models.CASCADE, related_name='footfall_counts')
    timestamp = models.DateTimeField(verbose_name="–í—Ä–µ–º—è –∑–∞–º–µ—Ä–∞")
    count = models.IntegerField(verbose_name="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π", help_text="–ó–∞ —á–∞—Å")
    counted_by = models.ForeignKey('users.User', on_delete=models.SET_NULL, null=True)

    class Meta:
        verbose_name = "–ü—Ä–æ—Ö–æ–¥–∏–º–æ—Å—Ç—å"
        verbose_name_plural = "–ü—Ä–æ—Ö–æ–¥–∏–º–æ—Å—Ç—å"
        ordering = ['-timestamp']

    def __str__(self):
        return f"{self.outlet.name} - {self.count} —á–µ–ª/—á–∞—Å ({self.timestamp.strftime('%d.%m.%Y %H:%M')})"


class OutletInventory(models.Model):
    """–ù–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–µ"""
    outlet = models.ForeignKey('Outlet', on_delete=models.CASCADE, related_name='inventory')
    product = models.ForeignKey('catalog.Product', on_delete=models.CASCADE)
    quantity = models.IntegerField(verbose_name="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ")
    last_updated = models.DateTimeField(auto_now=True, verbose_name="–û–±–Ω–æ–≤–ª–µ–Ω–æ")
    updated_by = models.ForeignKey('users.User', on_delete=models.SET_NULL, null=True)

    class Meta:
        verbose_name = "–ù–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–∞"
        verbose_name_plural = "–ù–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–æ–≤"
        unique_together = ['outlet', 'product']

    def __str__(self):
        return f"{self.product.name} –≤ {self.outlet.name}: {self.quantity} —à—Ç"


class Display(models.Model):
    """–í–∏—Ç—Ä–∏–Ω–∞/–ü—Ä–∏–ª–∞–≤–æ–∫ –≤ —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–µ"""
    DISPLAY_TYPES = [
        ('counter', '–ü—Ä–∏–ª–∞–≤–æ–∫'),
        ('showcase', '–í–∏—Ç—Ä–∏–Ω–∞'),
        ('stand', '–°—Ç–µ–Ω–¥'),
        ('wall', '–°—Ç–µ–ª–ª–∞–∂'),
    ]

    outlet = models.ForeignKey('Outlet', on_delete=models.CASCADE, related_name='displays')
    name = models.CharField(max_length=200, verbose_name="–ù–∞–∑–≤–∞–Ω–∏–µ")
    display_type = models.CharField(max_length=50, choices=DISPLAY_TYPES, verbose_name="–¢–∏–ø")
    location = models.CharField(max_length=200, blank=True, verbose_name="–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ", help_text="–ù–∞–ø—Ä–∏–º–µ—Ä: –£ –≤—Ö–æ–¥–∞, –¶–µ–Ω—Ç—Ä –∑–∞–ª–∞")
    is_active = models.BooleanField(default=True, verbose_name="–ê–∫—Ç–∏–≤–Ω–∞")

    class Meta:
        verbose_name = "–í–∏—Ç—Ä–∏–Ω–∞"
        verbose_name_plural = "–í–∏—Ç—Ä–∏–Ω—ã"

    def __str__(self):
        return f"{self.get_display_type_display()} - {self.name} ({self.outlet.name})"


class DisplayInventory(models.Model):
    """–¢–æ–≤–∞—Ä—ã –≤—ã–ª–æ–∂–µ–Ω–Ω—ã–µ –Ω–∞ –≤–∏—Ç—Ä–∏–Ω–µ"""
    display = models.ForeignKey('Display', on_delete=models.CASCADE, related_name='items')
    product = models.ForeignKey('catalog.Product', on_delete=models.CASCADE)
    quantity = models.IntegerField(verbose_name="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ")
    position = models.CharField(max_length=100, blank=True, verbose_name="–ü–æ–∑–∏—Ü–∏—è", help_text="–ù–∞–ø—Ä–∏–º–µ—Ä: –í–µ—Ä—Ö–Ω—è—è –ø–æ–ª–∫–∞ —Å–ª–µ–≤–∞")
    last_updated = models.DateTimeField(auto_now=True)

    class Meta:
        verbose_name = "–¢–æ–≤–∞—Ä –Ω–∞ –≤–∏—Ç—Ä–∏–Ω–µ"
        verbose_name_plural = "–¢–æ–≤–∞—Ä—ã –Ω–∞ –≤–∏—Ç—Ä–∏–Ω–∞—Ö"
        unique_together = ['display', 'product']

    def __str__(self):
        return f"{self.product.name} –Ω–∞ {self.display.name}: {self.quantity} —à—Ç"


# visits/models.py

class Sale(models.Model):
    """–ü—Ä–æ–¥–∞–∂–∞ —Ç–æ–≤–∞—Ä–∞"""
    outlet = models.ForeignKey('geo.Outlet', on_delete=models.CASCADE, related_name='sales')
    product = models.ForeignKey('catalog.Product', on_delete=models.CASCADE, related_name='sales')
    quantity = models.IntegerField(verbose_name="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ")
    price = models.DecimalField(max_digits=10, decimal_places=2, verbose_name="–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É")
    total_amount = models.DecimalField(max_digits=12, decimal_places=2, verbose_name="–°—É–º–º–∞")
    sale_date = models.DateTimeField(verbose_name="–î–∞—Ç–∞ –ø—Ä–æ–¥–∞–∂–∏")
    recorded_at = models.DateTimeField(auto_now_add=True, verbose_name="–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ")
    recorded_by = models.ForeignKey('users.User', on_delete=models.SET_NULL, null=True)

    class Meta:
        verbose_name = "–ü—Ä–æ–¥–∞–∂–∞"
        verbose_name_plural = "–ü—Ä–æ–¥–∞–∂–∏"
        ordering = ['-sale_date']

    def save(self, *args, **kwargs):
        self.total_amount = self.quantity * self.price
        super().save(*args, **kwargs)

    def __str__(self):
        return f"{self.product.name} - {self.quantity} —à—Ç x {self.price}‚ÇΩ = {self.total_amount}‚ÇΩ"
```

**–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:**

```bash
python manage.py makemigrations geo visits
python manage.py migrate
```

**–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ admin:**

```python
# geo/admin.py
from .models import FootfallCounter, OutletInventory, Display, DisplayInventory

@admin.register(FootfallCounter)
class FootfallCounterAdmin(admin.ModelAdmin):
    list_display = ['outlet', 'timestamp', 'count', 'counted_by']
    list_filter = ['outlet__region', 'timestamp']
    search_fields = ['outlet__name']

@admin.register(OutletInventory)
class OutletInventoryAdmin(admin.ModelAdmin):
    list_display = ['outlet', 'product', 'quantity', 'last_updated']
    list_filter = ['outlet__region', 'outlet__channel']
    search_fields = ['outlet__name', 'product__name']

@admin.register(Display)
class DisplayAdmin(admin.ModelAdmin):
    list_display = ['name', 'display_type', 'outlet', 'location', 'is_active']
    list_filter = ['display_type', 'outlet__region']

@admin.register(DisplayInventory)
class DisplayInventoryAdmin(admin.ModelAdmin):
    list_display = ['display', 'product', 'quantity', 'position']
    list_filter = ['display__outlet__region']

# visits/admin.py
@admin.register(Sale)
class SaleAdmin(admin.ModelAdmin):
    list_display = ['product', 'outlet', 'quantity', 'price', 'total_amount', 'sale_date']
    list_filter = ['sale_date', 'outlet__region']
    search_fields = ['product__name', 'outlet__name']
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í—Å–µ 21 –º–µ—Ç—Ä–∏–∫–∞ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–æ–±—Ä–∞–Ω—ã –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

---

#### 3.2. –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ üü¢

**–£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è fill_visit.html:**

```html
<!-- templates/visits/fill_visit.html -->

{% block extra_css %}
<style>
/* –ú–æ–±–∏–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è */
@media (max-width: 768px) {
    /* –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –≤—Å–µ—Ö –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ */
    .form-control, .form-select {
        font-size: 16px !important; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å zoom –Ω–∞ iOS */
        min-height: 48px;
    }

    /* Sticky —Ñ—É—Ç–µ—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏ */
    .sticky-actions {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        border-top: 2px solid #dee2e6;
        padding: 10px;
        box-shadow: 0 -4px 6px rgba(0,0,0,0.1);
        z-index: 1000;
    }

    /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
    .main-content {
        padding-bottom: 80px;
    }

    /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è */
    .progress-bar-container {
        position: sticky;
        top: 56px;
        z-index: 999;
        background: white;
        padding: 10px;
        border-bottom: 1px solid #dee2e6;
    }
}

/* –ê–∫–∫–æ—Ä–¥–µ–æ–Ω—ã –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ–ª–µ–π */
.field-group {
    border: 1px solid #dee2e6;
    border-radius: 8px;
    margin-bottom: 15px;
}

.field-group-header {
    background: #f8f9fa;
    padding: 15px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.field-group-body {
    padding: 15px;
    display: none;
}

.field-group-body.show {
    display: block;
}
</style>
{% endblock %}

<!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
<div class="progress-bar-container d-md-none">
    <div class="d-flex justify-content-between mb-2">
        <small class="text-muted">–ó–∞–ø–æ–ª–Ω–µ–Ω–æ</small>
        <small class="text-muted"><span id="progressPercent">0</span>%</small>
    </div>
    <div class="progress">
        <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
    </div>
</div>

<!-- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ–ª–µ–π –≤ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω—ã -->
<div class="field-group">
    <div class="field-group-header" onclick="toggleGroup(this)">
        <span><i class="bi bi-file-text"></i> –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span>
        <i class="bi bi-chevron-down"></i>
    </div>
    <div class="field-group-body show">
        <!-- –ü–æ–ª—è —Ñ–æ—Ä–º—ã -->
    </div>
</div>

<!-- Sticky —Ñ—É—Ç–µ—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏ (—Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö) -->
<div class="sticky-actions d-md-none">
    <div class="d-grid gap-2">
        {% if visit.status == 'in_progress' %}
            <button type="submit" class="btn btn-success btn-lg">
                <i class="bi bi-check-circle-fill"></i> –ó–∞–≤–µ—Ä—à–∏—Ç—å –≤–∏–∑–∏—Ç
            </button>
        {% endif %}
    </div>
</div>

<script>
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–æ–≤
function toggleGroup(header) {
    const body = header.nextElementSibling;
    const icon = header.querySelector('.bi-chevron-down, .bi-chevron-up');

    body.classList.toggle('show');
    icon.classList.toggle('bi-chevron-down');
    icon.classList.toggle('bi-chevron-up');
}

// –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
function updateProgress() {
    const inputs = document.querySelectorAll('input[required], select[required], textarea[required]');
    let filled = 0;

    inputs.forEach(input => {
        if (input.type === 'checkbox') {
            if (input.checked) filled++;
        } else if (input.value.trim() !== '') {
            filled++;
        }
    });

    const percent = Math.round((filled / inputs.length) * 100);
    document.getElementById('progressPercent').textContent = percent;
    document.getElementById('progressBar').style.width = percent + '%';
}

// –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
document.querySelectorAll('input, select, textarea').forEach(element => {
    element.addEventListener('change', updateProgress);
    element.addEventListener('input', updateProgress);
});

// –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
updateProgress();
</script>
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ú–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º, –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞–º–∏, sticky —Ñ—É—Ç–µ—Ä–æ–º

---

#### 3.3. Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤ üü¢

**–î–æ–±–∞–≤–∏—Ç—å auto-refresh –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤:**

```html
<!-- templates/analytics/dashboard_detail.html -->

<div class="row mb-4">
    <div class="col">
        <h1 class="h2">
            <i class="bi bi-graph-up"></i> {{ object.name }}
            <span id="lastUpdated" class="small text-muted"></span>
        </h1>
    </div>
    <div class="col-auto">
        <div class="btn-group">
            <button class="btn btn-outline-secondary" onclick="toggleAutoRefresh()">
                <i id="autoRefreshIcon" class="bi bi-pause-circle"></i>
                <span id="autoRefreshText">–ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
            </button>
            <button class="btn btn-primary" onclick="refreshDashboard()">
                <i class="bi bi-arrow-clockwise"></i> –û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
    </div>
</div>

<script>
let autoRefreshEnabled = false;
let autoRefreshInterval = null;
const REFRESH_INTERVAL = 60000; // 60 —Å–µ–∫—É–Ω–¥

function refreshDashboard() {
    const loader = document.createElement('div');
    loader.className = 'position-fixed top-50 start-50 translate-middle';
    loader.innerHTML = '<div class="spinner-border text-primary" role="status"></div>';
    document.body.appendChild(loader);

    location.reload();
}

function toggleAutoRefresh() {
    autoRefreshEnabled = !autoRefreshEnabled;

    const icon = document.getElementById('autoRefreshIcon');
    const text = document.getElementById('autoRefreshText');

    if (autoRefreshEnabled) {
        icon.className = 'bi bi-play-circle-fill';
        text.textContent = '–ê–≤—Ç–æ: –í–ö–õ';

        autoRefreshInterval = setInterval(refreshDashboard, REFRESH_INTERVAL);
        updateLastRefreshed();
    } else {
        icon.className = 'bi bi-pause-circle';
        text.textContent = '–ê–≤—Ç–æ: –í–´–ö–õ';

        if (autoRefreshInterval) {
            clearInterval(autoRefreshInterval);
        }
    }
}

function updateLastRefreshed() {
    const now = new Date();
    document.getElementById('lastUpdated').textContent =
        `(–æ–±–Ω–æ–≤–ª–µ–Ω–æ ${now.toLocaleTimeString()})`;
}

// –ü–æ–∫–∞–∑–∞—Ç—å –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
updateLastRefreshed();
</script>
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –î–∞—à–±–æ—Ä–¥—ã –º–æ–≥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

---

## ‚úÖ –ü–û–õ–ù–´–ô –ß–ï–ö–õ–ò–°–¢ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### üì± –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ø–æ–ª–µ–≤—ã—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤

- [ ] **PWA —É—Å—Ç–∞–Ω–æ–≤–∫–∞**
  - [ ] –°–æ–∑–¥–∞—Ç—å manifest.json
  - [ ] –°–æ–∑–¥–∞—Ç—å Service Worker
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–∫–æ–Ω–∫–∏ 192x192 –∏ 512x512
  - [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å –≤ base.html
  - [ ] –°–æ–∑–¥–∞—Ç—å offline.html —Å—Ç—Ä–∞–Ω–∏—Ü—É
  - [ ] –î–æ–±–∞–≤–∏—Ç—å Install Banner

- [ ] **–û—Ñ—Ñ–ª–∞–π–Ω —Ä–∞–±–æ—Ç–∞**
  - [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
  - [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
  - [ ] IndexedDB –¥–ª—è pending –≤–∏–∑–∏—Ç–æ–≤
  - [ ] Background Sync API
  - [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞

- [ ] **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**
  - [ ] –°–æ–∑–¥–∞—Ç—å autosave.js
  - [ ] –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫ –≤ LocalStorage
  - [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
  - [ ] –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
  - [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

- [ ] **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è**
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è latitude/longitude –≤ Visit
  - [ ] –î–æ–±–∞–≤–∏—Ç—å distance_from_outlet
  - [ ] JavaScript –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
  - [ ] –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è (Haversine)
  - [ ] –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞
  - [ ] –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤–∏–∑–∏—Ç–∞

- [ ] **UX —É–ª—É—á—à–µ–Ω–∏—è**
  - [ ] –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –ø–æ–ª—è (form-control-lg)
  - [ ] –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã (3em)
  - [ ] Sticky —Ñ—É—Ç–µ—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏
  - [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
  - [ ] –ê–∫–∫–æ—Ä–¥–µ–æ–Ω—ã –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
  - [ ] Font-size 16px (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ zoom –Ω–∞ iOS)

- [ ] **–§–æ—Ç–æ**
  - [ ] Multiple –∑–∞–≥—Ä—É–∑–∫–∞
  - [ ] –ü—Ä–µ–≤—å—é —Ñ–æ—Ç–æ
  - [ ] –°–∂–∞—Ç–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
  - [ ] –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ
  - [ ] –ò–Ω–¥–∏–∫–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞

---

### üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

- [ ] **–î–∞—à–±–æ—Ä–¥—ã**
  - [ ] –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å DashboardDetailView
  - [ ] –ú–µ—Ç–æ–¥ calculate_metric()
  - [ ] –ú–µ—Ç–æ–¥ calculate_chart()
  - [ ] –®–∞–±–ª–æ–Ω —Å –≤–∏–¥–∂–µ—Ç–∞–º–∏
  - [ ] Chart.js –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
  - [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ JSON
  - [ ] –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

- [ ] **–û—Ç—á–µ—Ç—ã**
  - [ ] –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å ReportDetailView
  - [ ] –ü–∞—Ä—Å–∏–Ω–≥ result JSON
  - [ ] –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü
  - [ ] –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≥—Ä–∞—Ñ–∏–∫–æ–≤
  - [ ] –ö–Ω–æ–ø–∫–∞ "–ü–µ—á–∞—Ç—å"
  - [ ] –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ <details>

- [ ] **PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏—è**
  - [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å WeasyPrint
  - [ ] –°–æ–∑–¥–∞—Ç—å ReportPDFView
  - [ ] –®–∞–±–ª–æ–Ω report_pdf.html
  - [ ] CSS –¥–ª—è –ø–µ—á–∞—Ç–∏
  - [ ] –î–æ–±–∞–≤–∏—Ç—å URL
  - [ ] –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

- [ ] **–§–∏–ª—å—Ç—Ä—ã**
  - [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç filters.html
  - [ ] –§–∏–ª—å—Ç—Ä –ø–æ –ø–µ—Ä–∏–æ–¥—É
  - [ ] –§–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–≥–∏–æ–Ω—É
  - [ ] –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞–Ω–∞–ª—É
  - [ ] –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  - [ ] Custom –¥–∞—Ç—ã
  - [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ—Å–µ—Ç–æ–≤
  - [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ views

- [ ] **Real-time**
  - [ ] Auto-refresh –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å
  - [ ] –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (60 —Å–µ–∫)
  - [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  - [ ] Loader –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

---

### üóÑÔ∏è –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

- [ ] **FootfallCounter**
  - [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å
  - [ ] –ú–∏–≥—Ä–∞—Ü–∏—è
  - [ ] Admin –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  - [ ] CRUD views
  - [ ] –®–∞–±–ª–æ–Ω—ã

- [ ] **OutletInventory**
  - [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å
  - [ ] –ú–∏–≥—Ä–∞—Ü–∏—è
  - [ ] Admin –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  - [ ] CRUD views
  - [ ] –®–∞–±–ª–æ–Ω—ã

- [ ] **Display**
  - [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å
  - [ ] –ú–∏–≥—Ä–∞—Ü–∏—è
  - [ ] Admin –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  - [ ] CRUD views
  - [ ] –®–∞–±–ª–æ–Ω—ã

- [ ] **DisplayInventory**
  - [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å
  - [ ] –ú–∏–≥—Ä–∞—Ü–∏—è
  - [ ] Admin –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  - [ ] CRUD views
  - [ ] –®–∞–±–ª–æ–Ω—ã

- [ ] **Sale**
  - [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å
  - [ ] –ú–∏–≥—Ä–∞—Ü–∏—è
  - [ ] Admin –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  - [ ] CRUD views
  - [ ] –®–∞–±–ª–æ–Ω—ã
  - [ ] –ê–≤—Ç–æ–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ total_amount

---

### üé® UI/UX –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- [ ] **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã**
  - [ ] Horizontal scroll –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
  - [ ] Responsive –∑–∞–≥–æ–ª–æ–≤–∫–∏
  - [ ] –ö–∞—Ä—Ç–æ—á–Ω—ã–π –≤–∏–¥ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤

- [ ] **–í–∏–¥–∂–µ—Ç—ã –º–µ—Ç—Ä–∏–∫**
  - [ ] –ë–æ–ª—å—à–∏–µ —á–∏—Å–ª–∞
  - [ ] –¶–≤–µ—Ç–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
  - [ ] % –∏–∑–º–µ–Ω–µ–Ω–∏—è
  - [ ] Sparkline –≥—Ä–∞—Ñ–∏–∫–∏

- [ ] **–ù–∞–≤–∏–≥–∞—Ü–∏—è**
  - [ ] Breadcrumbs
  - [ ] Drill-down –ø–æ –¥–∞–Ω–Ω—ã–º
  - [ ] Back button

- [ ] **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
  - [ ] Toast notifications
  - [ ] Success/Error/Warning
  - [ ] Auto-dismiss

---

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

- [ ] **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
  - [ ] WeasyPrint –¥–ª—è PDF
  - [ ] Pillow –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  - [ ] python-dateutil –¥–ª—è –¥–∞—Ç

- [ ] **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã**
  - [ ] service-worker.js
  - [ ] manifest.json
  - [ ] autosave.js
  - [ ] –ò–∫–æ–Ω–∫–∏ PWA

- [ ] **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Django**
  - [ ] MEDIA_ROOT/MEDIA_URL
  - [ ] FILE_UPLOAD_MAX_MEMORY_SIZE
  - [ ] SECURE_SSL_REDIRECT –¥–ª—è PWA

- [ ] **URL routing**
  - [ ] /offline/
  - [ ] /reports/<id>/pdf/
  - [ ] /dashboards/<id>/
  - [ ] /api/sync/ (–¥–ª—è Background Sync)

---

### üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [ ] **–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
  - [ ] –ö–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PWA
  - [ ] –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ñ—Ñ–ª–∞–π–Ω
  - [ ] –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –¥–∞—à–±–æ—Ä–¥
  - [ ] –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã

- [ ] **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≥–∞–π–¥—ã**
  - [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤ (JSON schema)
  - [ ] –§–æ—Ä–º–∞—Ç result –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤
  - [ ] API –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

- [ ] **–ü—Ä–∏–º–µ—Ä—ã**
  - [ ] –ü—Ä–∏–º–µ—Ä—ã –¥–∞—à–±–æ—Ä–¥–æ–≤
  - [ ] –ü—Ä–∏–º–µ—Ä—ã –æ—Ç—á–µ—Ç–æ–≤
  - [ ] –ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤

---

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ**
  - [ ] –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
  - [ ] PWA —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
  - [ ] –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç
  - [ ] –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è
  - [ ] –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

- [ ] **–ö—Ä–æ—Å—Å–±—Ä–∞—É–∑–µ—Ä–Ω–æ–µ**
  - [ ] Chrome (Android)
  - [ ] Safari (iOS)
  - [ ] Firefox
  - [ ] Edge

- [ ] **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**
  - [ ] iPhone (—Ä–∞–∑–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã)
  - [ ] Android (—Ä–∞–∑–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã)
  - [ ] –ü–ª–∞–Ω—à–µ—Ç—ã
  - [ ] Desktop

- [ ] **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
  - [ ] Lighthouse score > 90
  - [ ] Time to Interactive < 3s
  - [ ] First Contentful Paint < 1.5s

---

## üìà –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê

### –î–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
- ‚ö†Ô∏è –î–∞—à–±–æ—Ä–¥—ã: 0% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç JSON)
- ‚ö†Ô∏è –û—Ç—á–µ—Ç—ã: 0% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç JSON)
- ‚ö†Ô∏è –ú–æ–±–∏–ª—å–Ω—ã–π UX: 50% (—Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ—É–¥–æ–±–Ω–æ)
- ‚ö†Ô∏è –û—Ñ—Ñ–ª–∞–π–Ω: 0% (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

### –ü–æ—Å–ª–µ –§–∞–∑—ã 1 (MVP)
- ‚úÖ –î–∞—à–±–æ—Ä–¥—ã: 80% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ –û—Ç—á–µ—Ç—ã: 70% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ –ú–æ–±–∏–ª—å–Ω—ã–π UX: 80%
- ‚úÖ –û—Ñ—Ñ–ª–∞–π–Ω: 90%

### –ü–æ—Å–ª–µ –§–∞–∑—ã 2 (–ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)
- ‚úÖ –î–∞—à–±–æ—Ä–¥—ã: 95% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ –û—Ç—á–µ—Ç—ã: 95% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (—Å PDF)
- ‚úÖ –ú–æ–±–∏–ª—å–Ω—ã–π UX: 90%
- ‚úÖ –í—Å–µ 21 –º–µ—Ç—Ä–∏–∫–∞ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è

### –ü–æ—Å–ª–µ –§–∞–∑—ã 3 (–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
- ‚úÖ –î–∞—à–±–æ—Ä–¥—ã: 100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ –û—Ç—á–µ—Ç—ã: 100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ –ú–æ–±–∏–ª—å–Ω—ã–π UX: 95%
- ‚úÖ Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ü–æ–ª–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

---

## üéØ –ü–†–ò–û–†–ò–¢–ò–ó–ê–¶–ò–Ø

### üî¥ –ö–†–ò–¢–ò–ß–ù–û (–î–µ–ª–∞—Ç—å –ü–ï–†–í–´–ú–ò)
1. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤
2. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
3. PWA (Service Worker + Manifest)
4. –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º

**–ë–µ–∑ —ç—Ç–æ–≥–æ —Å–∏—Å—Ç–µ–º–∞ –ù–ï –†–ê–ë–û–¢–ê–ï–¢**

### üü° –í–ê–ñ–ù–û (–í—Ç–æ—Ä–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
5. –§–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
6. PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
7. –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
8. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ

**–≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –£–î–û–ë–ù–û–ô**

### üü¢ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û (–¢—Ä–µ—Ç–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
9. –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ (FootfallCounter, etc)
10. –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–∞–∫–∫–æ—Ä–¥–µ–æ–Ω—ã, –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä)
11. Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –û–¢–õ–ò–ß–ù–û–ô**

---

## üìÖ TIMELINE

### –ù–µ–¥–µ–ª—è 1-2: –§–ê–ó–ê 1 - MVP
**–¶–µ–ª—å:** –°–¥–µ–ª–∞—Ç—å —Ä–∞–±–æ—Ç–∞—é—â—É—é —Å–∏—Å—Ç–µ–º—É

- –î–µ–Ω—å 1-3: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤
- –î–µ–Ω—å 4-5: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
- –î–µ–Ω—å 6-8: PWA —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –î–µ–Ω—å 9-10: –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–∞

### –ù–µ–¥–µ–ª—è 3: –§–ê–ó–ê 2 - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å –≤–∞–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- –î–µ–Ω—å 11-12: –§–∏–ª—å—Ç—Ä—ã
- –î–µ–Ω—å 13-14: PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- –î–µ–Ω—å 15-16: –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
- –î–µ–Ω—å 17: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ —É–¥–æ–±–Ω–∞

### –ù–µ–¥–µ–ª—è 4: –§–ê–ó–ê 3 - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
**–¶–µ–ª—å:** –î–æ–≤–µ—Å—Ç–∏ –¥–æ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–∞

- –î–µ–Ω—å 18-19: –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏
- –î–µ–Ω—å 20-21: –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –î–µ–Ω—å 22: Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –î–µ–Ω—å 23-24: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–∞–≥-—Ñ–∏–∫—Å—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ª–∏—á–Ω–∞—è –∏ –≥–æ—Ç–æ–≤–∞ –∫ production

---

## üöÄ DEPLOYMENT CHECKLIST

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –Ω–∞ production
- [ ] –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] –°–æ–±—Ä–∞–Ω—ã static —Ñ–∞–π–ª—ã (`collectstatic`)
- [ ] HTTPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è PWA)
- [ ] Service Worker —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ HTTPS
- [ ] –ò–∫–æ–Ω–∫–∏ PWA —Å–æ–∑–¥–∞–Ω—ã
- [ ] PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω WeasyPrint)
- [ ] Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –õ–æ–≥–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Performance —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å PWA —É—Å—Ç–∞–Ω–æ–≤–∫—É
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- [ ] –û–±—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê –ò –û–ë–†–ê–¢–ù–ê–Ø –°–í–Ø–ó–¨

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:** [—Å–æ–∑–¥–∞—Ç—å –∫–∞–Ω–∞–ª]
- **–ë–∞–≥–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:** GitHub Issues
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [—Å–æ–∑–¥–∞—Ç—å wiki]

### –°–±–æ—Ä –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- –û–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

---

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-11-22
**–í–µ—Ä—Å–∏—è –ø–ª–∞–Ω–∞:** 1.0
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚úÖ
