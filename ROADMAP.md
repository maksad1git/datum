# DATUM - План разработки

**Версия:** 1.0
**Дата:** 2025-11-30
**Текущая готовность:** 70%

---

## Содержание

1. [Текущее состояние](#текущее-состояние)
2. [Краткосрочные цели (1-2 месяца)](#краткосрочные-цели-1-2-месяца)
3. [Среднесрочные цели (3-6 месяцев)](#среднесрочные-цели-3-6-месяцев)
4. [Долгосрочные цели (6-12 месяцев)](#долгосрочные-цели-6-12-месяцев)
5. [Приоритеты разработки](#приоритеты-разработки)
6. [Детальный план работ](#детальный-план-работ)

---

## Текущее состояние

### ✅ Что готово (70%)

**Полностью реализованные модули:**
- Core - ядро системы, настройки, логирование
- Users - пользователи, роли, права доступа
- Geo - 5-уровневая структура точек
- Catalog - каталог товаров с EAV системой
- Coefficients - коэффициенты, метрики, формулы
- Visits - визиты и наблюдения (desktop + mobile)

**Функционал:**
- Авторизация и права доступа
- CRUD для всех основных сущностей
- Каскадные селекты (AJAX)
- Мобильный интерфейс для тайного покупателя
- Оффлайн режим (PWA)
- Audit Trail (логирование изменений)
- Management команды (setup_fonon и др.)

### ⚠️ Требует завершения (30%)

**Forms (40% готовности):**
- ✅ Модель
- ✅ Templates
- ❌ Views, Forms
- ❌ UI конструктора

**Analytics (50% готовности):**
- ✅ Модели
- ✅ Templates
- ❌ Views, Forms
- ❌ Логика генерации отчетов
- ❌ PDF генерация
- ❌ ML прогнозирование

**Integrations (20% готовности):**
- ✅ Модели
- ❌ Views, Forms, Templates
- ❌ Логика импорта/экспорта
- ❌ Внешние интеграции (1C, Google Sheets)
- ❌ Бэкапы

---

## Краткосрочные цели (1-2 месяца)

### Приоритет 1: Завершение базового функционала

#### 1.1 Forms приложение (1 неделя)

**Задачи:**
- [ ] Создать Views для FormTemplate (CRUD)
- [ ] Создать Forms для FormTemplate
- [ ] Реализовать JSON конструктор форм (UI)
- [ ] Интеграция с visits (выбор формы для визита)
- [ ] Тестирование на реальных формах

**Результат:** Пользователи могут создавать собственные формы для визитов без программирования.

#### 1.2 Analytics - базовые отчеты (2 недели)

**Задачи:**
- [ ] Создать Views для Dashboard, Report, ReportTemplate
- [ ] Создать Forms для всех моделей
- [ ] Реализовать генерацию HTML отчетов
- [ ] Реализовать экспорт в Excel (openpyxl)
- [ ] Создать 5-10 готовых шаблонов отчетов:
  - Отчет по визитам (по точкам, периодам)
  - Отчет по коэффициентам
  - Отчет по товарам
  - Сводный отчет по регионам
  - Отчет по пользователям (производительность)
- [ ] Система фильтров (FilterPreset)
- [ ] Тестирование на реальных данных

**Результат:** Аналитики могут генерировать базовые отчеты в HTML и Excel форматах.

#### 1.3 Улучшение существующего функционала (1 неделя)

**Задачи:**
- [ ] EXIF парсинг из фото (GPS, дата/время)
- [ ] Автозаполнение GPS визита из первого фото
- [ ] Валидация обязательных полей визита
- [ ] Улучшение мобильного интерфейса:
  - Сжатие фото перед загрузкой
  - Прогресс-бар загрузки
  - Подтверждение завершения визита
- [ ] Экспорт визитов в Excel с атрибутами товаров

**Результат:** Более удобная работа для тайных покупателей.

### Приоритет 2: Тестирование и документация

#### 2.1 Тестирование (1 неделя)

**Задачи:**
- [ ] Unit тесты для основных моделей
- [ ] Integration тесты для workflow визитов
- [ ] Тестирование мобильного интерфейса на разных устройствах
- [ ] Нагрузочное тестирование (100+ визитов, 1000+ товаров)
- [ ] Исправление найденных багов

**Результат:** Стабильная работа системы.

#### 2.2 Документация для пользователей (3 дня)

**Задачи:**
- [ ] Руководство администратора
- [ ] Руководство тайного покупателя
- [ ] Руководство аналитика
- [ ] Видео-инструкции (опционально)

**Результат:** Пользователи могут работать без обучения.

### Итого краткосрочный период: 5-6 недель

**Результат:**
- Forms приложение полностью работает
- Базовые отчеты доступны
- Улучшен UX для тайных покупателей
- Система протестирована
- Есть документация

**Готовность системы после этапа:** ~85%

---

## Среднесрочные цели (3-6 месяцев)

### Приоритет 1: Integrations приложение

#### 3.1 Импорт данных (2 недели)

**Задачи:**
- [ ] Views, Forms, Templates для ImportJob
- [ ] Импорт товаров из CSV/Excel
  - Маппинг полей
  - Валидация данных
  - Обработка ошибок
  - Статистика импорта
- [ ] Импорт точек (outlets) из CSV/Excel
- [ ] Импорт коэффициентов
- [ ] Фоновая обработка (Celery)
- [ ] UI для просмотра результатов

**Результат:** Можно массово загружать данные из файлов.

#### 3.2 Экспорт данных (1 неделя)

**Задачи:**
- [ ] Views, Forms, Templates для ExportJob
- [ ] Экспорт визитов в CSV/Excel
- [ ] Экспорт наблюдений
- [ ] Экспорт товаров с атрибутами
- [ ] Фильтрация данных для экспорта
- [ ] Планировщик экспортов (регулярные выгрузки)

**Результат:** Можно выгружать данные для внешних систем.

#### 3.3 Бэкапы (1 неделя)

**Задачи:**
- [ ] Views, Forms, Templates для Backup
- [ ] Полный бэкап БД (sqlite → zip)
- [ ] Инкрементальные бэкапы
- [ ] Автоматические бэкапы (cron/Celery)
- [ ] Восстановление из бэкапа
- [ ] Хранение на удаленном сервере (опционально)

**Результат:** Защита от потери данных.

#### 3.4 Внешние интеграции (2-3 недели)

**Задачи:**
- [ ] Интеграция с 1C:
  - Выгрузка товаров из 1C
  - Выгрузка визитов в 1C
  - Синхронизация справочников
- [ ] Интеграция с Google Sheets:
  - Экспорт отчетов в Google Sheets
  - Импорт данных из Google Sheets
- [ ] REST API (Django REST framework):
  - Endpoints для товаров
  - Endpoints для визитов
  - Endpoints для отчетов
  - Аутентификация (Token/JWT)
  - Документация (Swagger)

**Результат:** Система интегрируется с внешними сервисами.

### Приоритет 2: Analytics - продвинутая аналитика

#### 3.5 PDF отчеты (1 неделя)

**Задачи:**
- [ ] Подключить weasyprint
- [ ] Создать PDF шаблоны отчетов
- [ ] Генерация PDF с графиками (matplotlib/plotly)
- [ ] Логотип, брендирование отчетов
- [ ] Экспорт дашбордов в PDF

**Результат:** Красивые PDF отчеты для клиентов.

#### 3.6 Визуальный конструктор дашбордов (2 недели)

**Задачи:**
- [ ] Drag-and-drop конструктор виджетов
- [ ] Библиотека виджетов:
  - Графики (line, bar, pie)
  - Таблицы
  - Метрики (большие цифры)
  - Карты (опционально)
- [ ] Настройка фильтров дашборда
- [ ] Публикация/приватность дашбордов
- [ ] Экспорт виджетов в изображения

**Результат:** Аналитики создают дашборды без программирования.

#### 3.7 Базовое прогнозирование (1-2 недели)

**Задачи:**
- [ ] Подключить scikit-learn
- [ ] Реализовать линейную регрессию
- [ ] Реализовать экспоненциальное сглаживание
- [ ] UI для настройки прогнозов
- [ ] Визуализация прогнозов на графиках
- [ ] Сохранение моделей

**Результат:** Базовое прогнозирование продаж и метрик.

### Приоритет 3: Улучшения UX/UI

#### 3.8 Улучшенный UI (2 недели)

**Задачи:**
- [ ] Обновить дизайн главной страницы
- [ ] Добавить дашборд на главную:
  - Статистика по визитам
  - Топ товаров
  - Топ точек
  - График визитов по дням
- [ ] Улучшить навигацию (breadcrumbs везде)
- [ ] Добавить поиск везде (search bar)
- [ ] Темная тема (опционально)
- [ ] Анимации и transitions

**Результат:** Современный приятный интерфейс.

#### 3.9 Уведомления (1 неделя)

**Задачи:**
- [ ] Email уведомления:
  - Новый визит назначен
  - Визит просрочен
  - Отчет готов
- [ ] Push уведомления (PWA)
- [ ] In-app уведомления (колокольчик)
- [ ] Настройки уведомлений пользователя

**Результат:** Пользователи не пропускают важные события.

### Итого среднесрочный период: 3-4 месяца

**Результат:**
- Integrations полностью работает
- PDF отчеты, дашборды, прогнозы
- REST API для внешних систем
- Улучшенный UI
- Уведомления

**Готовность системы после этапа:** ~95%

---

## Долгосрочные цели (6-12 месяцев)

### Приоритет 1: Продвинутая аналитика и ML

#### ML модели (1-2 месяца)

**Задачи:**
- [ ] Прогнозирование продаж (ARIMA, Prophet)
- [ ] Кластеризация точек (K-means)
- [ ] Рекомендательная система для товаров
- [ ] Аномалии в данных (Isolation Forest)
- [ ] Сентимент-анализ комментариев (NLP)
- [ ] AutoML для подбора моделей
- [ ] A/B тестирование

**Результат:** ИИ помогает принимать решения.

#### BI инструменты (1 месяц)

**Задачи:**
- [ ] Интеграция с Power BI (экспорт данных)
- [ ] Интеграция с Tableau
- [ ] Интеграция с Google Data Studio
- [ ] OLAP куб (опционально)
- [ ] Собственные BI инструменты (графики, срезы)

**Результат:** Профессиональная аналитика.

### Приоритет 2: Масштабирование

#### Производительность (2-3 недели)

**Задачи:**
- [ ] Миграция на PostgreSQL
- [ ] Оптимизация запросов (индексы, денормализация)
- [ ] Кеширование (Redis):
  - Кеш запросов
  - Кеш сессий
  - Кеш страниц
- [ ] CDN для статики
- [ ] Компрессия ответов (gzip)
- [ ] Lazy loading изображений
- [ ] Pagination везде

**Результат:** Система работает быстро с большими данными.

#### Фоновые задачи (1-2 недели)

**Задачи:**
- [ ] Настройка Celery + Redis
- [ ] Фоновая обработка:
  - Генерация отчетов
  - Импорт/экспорт данных
  - Отправка email
  - Обучение ML моделей
- [ ] Планировщик задач (Celery Beat)
- [ ] Мониторинг задач (Flower)

**Результат:** Долгие операции не блокируют UI.

#### Мультитенантность (2-3 недели)

**Задачи:**
- [ ] Поддержка нескольких организаций (tenants)
- [ ] Изоляция данных
- [ ] Отдельные настройки для tenant
- [ ] Billing система (опционально)
- [ ] Админ-панель для управления tenants

**Результат:** SaaS решение для множества компаний.

### Приоритет 3: Мобильное приложение

#### Native мобильное приложение (2-3 месяца)

**Задачи:**
- [ ] React Native / Flutter приложение
- [ ] Авторизация через REST API
- [ ] Список визитов
- [ ] Заполнение визитов (оффлайн)
- [ ] Камера с геотегами
- [ ] Push уведомления
- [ ] Синхронизация данных
- [ ] Публикация в App Store / Google Play

**Результат:** Профессиональное мобильное приложение.

### Приоритет 4: Дополнительные модули

#### Gamification (2-3 недели)

**Задачи:**
- [ ] Рейтинг тайных покупателей
- [ ] Достижения (badges)
- [ ] Лидерборд
- [ ] Бонусная система
- [ ] Квесты

**Результат:** Мотивация тайных покупателей.

#### CRM модуль (1-2 месяца)

**Задачи:**
- [ ] Управление клиентами
- [ ] История взаимодействий
- [ ] Воронка продаж
- [ ] Email кампании
- [ ] Сегментация клиентов

**Результат:** Полноценная CRM система.

#### Инвентаризация (2-3 недели)

**Задачи:**
- [ ] Учет товаров в точках
- [ ] Планограммы
- [ ] Ротация товаров
- [ ] Срок годности
- [ ] Заказы на пополнение

**Результат:** Контроль остатков товаров.

### Итого долгосрочный период: 6-9 месяцев

**Результат:**
- ML и продвинутая аналитика
- Масштабируемая архитектура
- Native мобильное приложение
- Дополнительные модули (CRM, gamification)

**Готовность системы после этапа:** 100%+ (полнофункциональная платформа)

---

## Приоритеты разработки

### Критически важно (сделать в первую очередь)

1. **Forms приложение** - без него нельзя создавать кастомные формы визитов
2. **Базовые отчеты в Analytics** - аналитики должны видеть данные
3. **EXIF парсинг** - GPS из фото автоматически
4. **Тестирование** - стабильность важнее новых фич

### Важно (сделать во вторую очередь)

5. **Импорт/экспорт** - массовая загрузка данных
6. **PDF отчеты** - для клиентов
7. **Бэкапы** - защита данных
8. **REST API** - для интеграций
9. **Улучшение UI** - удобство работы

### Желательно (можно отложить)

10. **ML прогнозирование** - не критично на старте
11. **Визуальный конструктор дашбордов** - можно создавать вручную
12. **Внешние интеграции (1C, Google Sheets)** - зависит от клиента
13. **Native приложение** - PWA работает достаточно хорошо

### Опционально (для будущего)

14. **Gamification** - дополнительная мотивация
15. **CRM модуль** - расширение функционала
16. **BI инструменты** - для крупных клиентов
17. **Мультитенантность** - если планируется SaaS

---

## Детальный план работ

### Месяц 1-2: Завершение базового функционала

**Неделя 1:**
- Forms: Views + Forms (3 дня)
- Forms: JSON конструктор UI (2 дня)

**Неделя 2:**
- Analytics: Views + Forms для Dashboard/Report (3 дня)
- Analytics: 5 шаблонов отчетов (2 дня)

**Неделя 3:**
- Analytics: Генерация HTML отчетов (2 дня)
- Analytics: Экспорт в Excel (1 день)
- Analytics: Система фильтров (2 дня)

**Неделя 4:**
- EXIF парсинг (2 дня)
- Улучшения мобильного интерфейса (2 дня)
- Экспорт визитов в Excel (1 день)

**Неделя 5:**
- Тестирование (5 дней)

**Неделя 6:**
- Документация (3 дня)
- Исправление багов (2 дня)

**Результат:** Готовность 85%, система готова к использованию

### Месяц 3-4: Integrations + Analytics Pro

**Неделя 7-8:**
- Импорт товаров/точек/коэффициентов (10 дней)

**Неделя 9:**
- Экспорт данных (5 дней)

**Неделя 10:**
- Бэкапы (5 дней)

**Неделя 11-12:**
- REST API (Django REST framework) (10 дней)

**Неделя 13:**
- PDF отчеты (5 дней)

**Неделя 14-15:**
- Визуальный конструктор дашбордов (10 дней)

**Неделя 16:**
- Базовое прогнозирование (5 дней)

**Результат:** Готовность 95%, полнофункциональная система

### Месяц 5-6: Улучшения + Интеграции

**Неделя 17-18:**
- Интеграция с 1C (10 дней)

**Неделя 19:**
- Интеграция с Google Sheets (5 дней)

**Неделя 20-21:**
- Улучшенный UI (10 дней)

**Неделя 22:**
- Уведомления (5 дней)

**Неделя 23-24:**
- Тестирование и оптимизация (10 дней)

**Результат:** Готовность 100%, production ready

### Месяц 7-12: Продвинутые функции (опционально)

**Месяц 7-8:**
- ML модели и прогнозирование

**Месяц 9:**
- Производительность и масштабирование

**Месяц 10-12:**
- Native мобильное приложение

**Результат:** Enterprise-level платформа

---

## Технические требования по этапам

### Этап 1 (Месяц 1-2)

**Зависимости:**
- openpyxl (уже есть)
- Pillow (уже есть)

**Инфраструктура:**
- SQLite (текущая)
- Django dev server (текущий)

### Этап 2 (Месяц 3-4)

**Зависимости:**
- Django REST framework
- weasyprint (PDF)
- matplotlib/plotly (графики)
- scikit-learn (ML)

**Инфраструктура:**
- Celery + Redis (фоновые задачи)
- Gunicorn (production сервер)

### Этап 3 (Месяц 5-6)

**Зависимости:**
- python-docx (1C документы)
- gspread (Google Sheets)
- requests (внешние API)

**Инфраструктура:**
- Nginx (reverse proxy)
- PostgreSQL (вместо SQLite)

### Этап 4 (Месяц 7-12)

**Зависимости:**
- tensorflow/pytorch (продвинутый ML)
- pandas, numpy (анализ данных)

**Инфраструктура:**
- Docker (контейнеризация)
- Kubernetes (оркестрация, опционально)
- S3/MinIO (файловое хранилище)

---

## Метрики успеха

### Технические метрики

**Производительность:**
- Время загрузки страницы < 2 сек
- Время генерации отчета < 10 сек
- Поддержка 1000+ визитов в день
- Поддержка 100+ одновременных пользователей

**Качество кода:**
- Test coverage > 80%
- Нет критических багов
- Code review всех изменений
- Документация всех API

**Стабильность:**
- Uptime > 99.5%
- Автоматические бэкапы каждый день
- Восстановление из бэкапа < 1 час

### Бизнес метрики

**Использование:**
- 50+ активных пользователей
- 100+ визитов в неделю
- 1000+ товаров в каталоге
- 10+ регулярных отчетов

**Удовлетворенность:**
- NPS > 8/10
- Отзывы пользователей > 4/5
- Время обучения нового пользователя < 1 час

---

## Риски и митигация

### Технические риски

**Риск:** Проблемы с производительностью при больших данных
**Митигация:** Ранняя миграция на PostgreSQL, индексы, кеширование

**Риск:** Сложность ML моделей
**Митигация:** Начать с простых моделей, поэтапное усложнение

**Риск:** Проблемы совместимости библиотек
**Митигация:** Использовать requirements.txt с точными версиями

### Организационные риски

**Риск:** Изменение требований в процессе разработки
**Митигация:** Agile подход, короткие итерации, частая обратная связь

**Риск:** Недостаток ресурсов для разработки
**Митигация:** Приоритизация задач, фокус на MVP

**Риск:** Сложность тестирования в реальных условиях
**Митигация:** Beta-тестирование с реальными пользователями

---

## Заключение

План разработки рассчитан на 12 месяцев с тремя основными этапами:

**Этап 1 (2 месяца):** Завершение базового функционала
- Результат: Production-ready система для базового Mystery Shopping

**Этап 2 (4 месяца):** Integrations + Analytics Pro
- Результат: Полнофункциональная платформа с интеграциями

**Этап 3 (6 месяцев):** Продвинутые функции
- Результат: Enterprise-level решение с ML и масштабированием

**Минимально жизнеспособный продукт (MVP):** Этап 1 (2 месяца)
**Полнофункциональная система:** Этап 2 (6 месяцев)
**Enterprise платформа:** Этап 3 (12 месяцев)

Приоритеты можно корректировать в зависимости от потребностей бизнеса.
